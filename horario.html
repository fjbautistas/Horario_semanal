<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.2"/>
  <title>Weekly Schedule</title>
  <style>
    /* --- Estilos Proporcionados (con ajustes) --- */
    :root { --header-bg: #e6e6f2; }
    body { font-family: sans-serif; /* margin: 20px; quitado para full width */ }
    table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed; /* Mantener layout fijo */
        border: 1px solid #ccc;
    }
    th, td {
        border: 1px solid #ccc;
        padding: 2px 4px; /* Padding ajustado de versi√≥n anterior */
        text-align: center;
        vertical-align: middle;
        font-size: 0.8em; /* Tama√±o ajustado para compacidad */
        overflow: hidden;
        text-overflow: ellipsis;
        position: relative; /* Necesario para z-index y posicionamiento de l√≠nea */
    }
    th {
        background-color: var(--header-bg);
        font-weight: bold;
    }
    /* Ancho columnas Hora */
    th:first-child, td:first-child,
    th:last-child, td:last-child {
        width: 55px; /* Ancho fijo como en tu ejemplo CSS */
        background-color: #e6e6f2; /* Fondo consistente para hora */
        font-size: 0.75em;
        white-space: nowrap;
    }
    /* td { height: 2px; } <-- Eliminado: altura se define por contenido y padding */

    /* Colores de Actividad */
    .curso { background-color: #374a60; 
      color: #fefae0; 
      font-weight: bold; /* A√±adido bold para cursos */ }
    .trabajo { background-color: #524962; 
      color: #eeeeee; }
    .personal { background-color: #e9c9f1; }
    .libre { background-color: #e6e6f2; } /* Mismo color que header/hora */
    .lectura-alistar-siguiente-dia { background-color: #e9c9f1; } /* Clase espec√≠fica */
    .alistamiento-traslado-uls { background-color: #121016; 
      color: #eeeeee; }
    .estudio-uls { background-color: #a3c4f3; }
    .casa { background-color: #a4a4a4; 
      font-weight: bold; } /* Gris para casa, tambi√©n seminario */
    .dormir { background-color: #000000; 
      color: #eeeeee; }
    .emoji-grande { font-size: 1.5em; line-height: 1; } /* Tama√±o ajustado */
    .subevento {
        border: 1px dashed #555; /* Borde m√°s sutil */
        margin-top: 3px;
        padding: 2px;
        font-size: 0.85em; /* Relativo al 0.8em del td */
        background-color: rgba(255, 255, 255, 0.5); /* Fondo semi-transparente */
        border-radius: 3px;
    }

    /* --- Estilos de Resaltado (Seg√∫n tu CSS) --- */
    .actual { /* Borde naranja para celda actividad actual */
        /* Usar outline para no afectar layout */
        outline: 2px solid rgba(255, 0, 0, 0.579);
        outline-offset: -2px; /* Para que el borde quede dentro */
        z-index: 5; /* Ponerla encima de celdas normales pero debajo de l√≠nea */
    }
    .dia-actual { /* Bordes rojos para cabecera d√≠a actual */
        border-top: 3px solid rgba(255, 0, 0, 0.48);
        border-bottom: 3px solid rgba(255, 0, 0, 0.48);
        /* Quitar borde izquierdo/derecho para evitar doble borde en esquinas */
        border-left-color: #ccc;
        border-right-color: #ccc;
        z-index: 4;
    }
    .hora-actual { /* Bordes rojos para celdas hora actual */
        border-left: 3px solid rgba(255, 0, 0, 0.48);
        border-right: 3px solid rgba(255, 0, 0, 0.48);
         /* Quitar borde superior/inferior para evitar doble borde en esquinas */
        border-top-color: #ccc;
        border-bottom-color: #ccc;
        box-sizing: border-box; /* Incluir borde en el tama√±o */
        z-index: 4;
    }

     .bloque-actual-info {
        position: fixed;
        bottom: 10px;
        left: 10px;
        background-color: rgba(0, 0, 0, 0.75);
        color: white;
        padding: 6px 10px;
        border-radius: 4px;
        font-size: 0.85em;
        z-index: 100;
    }
    .linea-roja-extendida { 
      position: absolute;
      background-color: rgba(255, 0, 0, 0.48);
      z-index: 20; /* Encima de todo */ 
      pointer-events: none; /* No interferir con clicks */ }

  </style>
</head>
<body>
    <h1 style="text-align: center; font-size: 1.5em; margin-bottom: 5px;">Weekly Schedule</h1>
    <table>
        <thead>
          <tr><th>Hour</th><th>Monday</th><th>Tuesday</th><th>Wednesday</th><th>Thursday</th><th>Friday</th><th>Saturday</th><th>Sunday</th><th>Hour</th></tr>
        </thead>
<tbody>
            <tr><td><b>06:30</b></td> <td rowspan="3" colspan="5" class="personal">Wake up ‚è∞, Exercise (45 min) üí™üèΩ & Breakfast ‚òï<br>(6:30 - 8:00)</td> <td colspan="2" class="libre"></td> <td><b>06:30</b></td> </tr>
            <tr><td><b>07:00</b></td> <td colspan="2" class="personal">Wake up ‚è∞</td><td><b>07:00</b></td></tr>
            <tr><td><b>07:30</b></td> <td rowspan="5" colspan="2" class="personal"> Exercise üí™üèΩ: Bike, Run-Walk, Strength<br>(7:30 - 10:00)</td> <td><b>07:30</b></td></tr>
            <tr><td><b>08:00</b></td> <td colspan="5" class="alistamiento-traslado-uls"> Get ready & leave for ULS</td> <td><b>08:00</b></td></tr>
            <tr><td><b>08:30</b></td> <td rowspan="5" class="estudio-uls"><div class="subevento"> <b>Group meeting</b><br></div><div class="subevento"> <b>Group meeting</b><br></div></td> <td rowspan="5" class="estudio-uls">Study at ULS<br>(8:30 - 11:00)</td> <td rowspan="3" class="estudio-uls">Study at ULS<br>(8:30 - 10:00)</td> <td rowspan="9" class="estudio-uls">Study at ULS<br>(8:30 - 13:00)</td> <td rowspan="9" class="estudio-uls">Study at ULS<br>(8:30 - 13:00)</td> <td><b>08:30</b></td></tr>
            <tr><td><b>09:00</b></td> <td><b>09:00</b></td></tr>
            <tr><td><b>09:30</b></td> <td><b>09:30</b></td></tr>
            <tr><td><b>10:00</b></td> <td rowspan="2" class="curso"><b>Thesis Project üìö<br>(10:00 - 11:00)</b></td> <td rowspan="6" class="casa"> Groceries & Cleaning <br>(10:00 - 13:00)</td> <td rowspan="6" class="trabajo"><b>Work at SGC üë®üèª‚Äçüíª <span class="emoji-grande">‚Äç</span> <br>(10:00 - 13:00)</td>  <td><b>10:00</b></td></tr>
            <tr><td><b>10:30</b></td> <td><b>10:30</b></td></tr>
            <tr><td><b>11:00</b></td> <td rowspan="4" class="estudio-uls">Study at ULS<br>(11:00 - 13:00)</td><td rowspan="2" class="curso"><b>Research Project II üìö <br>(11:30 - 12:10)</b></td> <td class="estudio-uls"></td> <td><b>11:00</b></td></tr>
            <tr><td><b>11:30</b></td> <td rowspan="3" class="curso"><b>Galaxy Formation & Evolution üìö<br>(11:30 - 13:00)</b></td><td><b>11:30</b></td></tr>
            <tr><td><b>12:00</b></td><td rowspan="2" class="curso"><b>Astro-Journal üìö <br>(12:00 - 13:00)</td> <td><b>12:00</b></td></tr>
            <tr><td><b>12:30</b></td> <td><b>12:30</b></td></tr>
            <tr><td><b>13:00</b></td> <td rowspan="2" colspan="7" class="casa"><b>Lunch</b></td> <td><b>13:00</b></td></tr>
            <tr><td><b>13:30</b></td> <td><b>13:30</b></td></tr>
            <tr><td><b>14:00</b></td> <td rowspan="7" class="estudio-uls">Study at ULS<br>(14:00 - 17:30)</td> <td class="estudio-uls"></td><td rowspan="7" class="estudio-uls">Study at ULS<br>(14:00 - 17:30)</td> <td colspan="2" class="estudio-uls"></td> <td rowspan="9" class="estudio-uls">Study at ULS<br>(14:00 - 18:30)</td><td rowspan="9" class="trabajo"><b>Work at SGC üë®üèª‚Äçüíª<span class="emoji-grande">‚Äç</span> <br>(14:00 - 18:30)</td><td><b>14:00</b></td></tr>
            <tr><td><b>14:30</b></td> <td rowspan="3" class="curso"><b>Galaxy Formation & Evolution üìö <br>(14:30 - 16:00)</td>
              <td rowspan="2" class="estudio-uls"><div class="subevento"><b>Astronomy Seminar</b></div></td>
              <td rowspan="3" class="curso"><b>Galaxy Formation & Evolution üìö <br>(14:30 - 16:00)</td> <td><b>14:30</b></td></tr>           <tr><td><b>15:00</b></td> <td><b>15:00</b></td></tr>
            <tr><td><b>15:30</b></td> <td rowspan="4" class="estudio-uls">Study at ULS<br>(15:30 - 17:30)</td> <td><b>15:30</b></td></tr>
            <tr><td><b>16:00</b></td> <td rowspan="3" class="estudio-uls">Study at ULS<br>(16:00 - 17:30)</td> <td rowspan="3" class="estudio-uls">Study at ULS<br>(16:00 - 17:30)</td> <td><b>16:00</b></td></tr>
            <tr><td><b>16:30</b></td> <td><b>16:30</b></td></tr>
            <tr><td><b>17:00</b></td> <td><b>17:00</b></td></tr>
            <tr><td><b>17:30</b></td> <td colspan="5" class="alistamiento-traslado-uls">Return home</td> <td><b>17:30</b></td></tr>
            <tr><td><b>18:00</b></td> <td rowspan="7" colspan="5" class="trabajo"><b>Work at SGC üë®üèª‚Äçüíª <span class="emoji-grande">‚Äç</span> <br>(18:00 - 21:30)</td> <td><b>18:00</b></td></tr>
            <tr><td><b>18:30</b></td> <td rowspan="6" colspan="2" class="libre"><b>‚ú® Free! ‚ú®<br>(18:30 - 21:30)</td> <td><b>18:30</b></td></tr>
            <tr><td><b>19:00</b></td> <td><b>19:00</b></td></tr>
            <tr><td><b>19:30</b></td> <td><b>19:30</b></td></tr>
            <tr><td><b>20:00</b></td> <td><b>20:00</b></td></tr>
            <tr><td><b>20:30</b></td> <td><b>20:30</b></td></tr>
            <tr><td><b>21:00</b></td> <td><b>21:00</b></td></tr>
            <tr><td><b>21:30</b></td> <td colspan="7" class="casa">Prep lunch - Dinner ‚òï </td> <td><b>21:30</b></td></tr>
            <tr><td><b>22:00</b></td> <td colspan="7" class="lectura-alistar-siguiente-dia">Reading - Prep for next day üìñ</td> <td><b>22:00</b></td></tr>
            <tr><td><b>22:30</b></td> <td colspan="7" class="dormir"><b>Sleep üò¥</b></td> <td><b>22:30</b></td></tr>
        </tbody>
    </table>

    <script>
      // Nombres de los d√≠as en espa√±ol (Domingo=0)
      const diasSemana = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
      const cuerpoTabla = document.querySelector("table tbody");
      const tabla = document.querySelector("table");
      const elementoTitulo = document.querySelector("h1");
      const filas = cuerpoTabla.querySelectorAll("tr"); // Cachear filas

      // Convierte una hora 'HH:MM' a minutos desde medianoche
      const convertirHoraAMinutos = (textoHora) => {
          // Parseo simple y robusto
          const match = textoHora?.match(/(\d{1,2}):(\d{2})/);
          return match ? parseInt(match[1], 10) * 60 + parseInt(match[2], 10) : 0;
      };

      // Muestra el d√≠a, fecha y hora actual en el t√≠tulo H1
      const mostrarDiaHoraActual = () => {
        const ahora = new Date(); // Obtiene fecha y hora actual
        const textoDiaActual = diasSemana[ahora.getDay()]; // Nombre del d√≠a

        // --- NUEVO: Formatear la fecha ---
        const opcionesFecha = { year: 'numeric', month: 'long', day: 'numeric' }; // Ej: "10 de abril de 2025"
        // Usar locale 'es-ES' para formato en espa√±ol
        const fechaFormateada = ahora.toLocaleDateString('en', opcionesFecha);

        // Formatear la hora (formato 24h)
        const horaFormateada = ahora.toLocaleTimeString('en', { hour: '2-digit', minute: '2-digit', hour12: false });

        // --- ACTUALIZADO: Incluir fecha en el t√≠tulo ---
        if (elementoTitulo) {
          // Formato: Horario Semanal: [D√≠a], [Fecha] - [Hora]
          elementoTitulo.textContent = `Weekly Schedule: ${textoDiaActual}, ${fechaFormateada} - ${horaFormateada}`;
        }
      };

      // Resalta la celda, d√≠a, hora actual y dibuja l√≠neas
      const resaltarCeldaActual = () => {
        const ahora = new Date(); // Hora actual
        const ahoraEnMinutos = ahora.getHours() * 60 + ahora.getMinutes(); // Hora actual en minutos
        const indiceDiaSemana = ahora.getDay(); // 0=Domingo, 1=Lunes,...
        // Columna objetivo: 1=Hora, 2=Lunes,..., 7=S√°bado, 8=Domingo, 9=Hora
        const columnaDiaObjetivo = indiceDiaSemana === 0 ? 8 : indiceDiaSemana + 1;

        // --- Limpieza previa ---
        document.querySelectorAll(".actual, .dia-actual, .hora-actual").forEach(el =>
          el.classList.remove("actual", "dia-actual", "hora-actual")
        );
        document.querySelectorAll(".linea-roja-extendida").forEach(el => el.remove());
        const infoDivAnterior = document.querySelector(".bloque-actual-info");
        if (infoDivAnterior) infoDivAnterior.remove();

        // --- Resaltar Cabecera D√≠a (con bordes top/bottom rojos) ---
        const celdaCabeceraDia = document.querySelector(`thead th:nth-child(${columnaDiaObjetivo})`);
        if (celdaCabeceraDia) {
          celdaCabeceraDia.classList.add("dia-actual"); // CSS aplica los bordes rojos
        }

        // --- Encontrar fila y Resaltar Celdas Hora (con bordes left/right rojos) ---
        let celdaHoraInicio = null;
        let celdaHoraFin = null;
        let textoBloqueEncontrado = null;
        let celdaActividadActual = null;
        let indiceFilaActual = -1;

        filas.forEach((fila, rowIndex) => {
            const celdaHora = fila.querySelector("td:first-child");
            if (!celdaHora || indiceFilaActual !== -1) return; // Si ya se encontr√≥ o no hay celda de hora
            const textoHoraFila = celdaHora.textContent.trim(); // Obtener texto de hora
            const inicioFilaEnMinutos = convertirHoraAMinutos(textoHoraFila); // Convertir a minutos
            const finFilaEnMinutos = inicioFilaEnMinutos + 30; // Asume intervalos de 30 min
            // Comprobar si la hora actual est√° en este intervalo de 30 min
            if (ahoraEnMinutos >= inicioFilaEnMinutos && ahoraEnMinutos < finFilaEnMinutos) {
                indiceFilaActual = rowIndex; // Guardar √≠ndice de la fila actual
                celdaHoraInicio = celdaHora; // Guardar celda de hora inicial
                celdaHoraFin = fila.querySelector("td:last-child"); // Guardar celda de hora final
            }
        });

        // Aplicar clase a las celdas de hora encontradas
        if (celdaHoraInicio && celdaHoraFin) {
          celdaHoraInicio.classList.add("hora-actual"); // CSS aplica bordes rojos
          celdaHoraFin.classList.add("hora-actual");   // CSS aplica bordes rojos
        }

        // --- Crear L√≠neas Rojas (S√≥lidas) ---
        // L√≠nea Horizontal
        if (celdaHoraInicio) {
            const lineaHorizontal = document.createElement("div");
            lineaHorizontal.className = "linea-roja-extendida"; // CSS aplica fondo rojo
            const rectTdHora = celdaHoraInicio.getBoundingClientRect(); // Posici√≥n celda hora
            const rectTable = tabla.getBoundingClientRect(); // Posici√≥n tabla

            // Verificar validez de las dimensiones antes de calcular
            if (rectTable.width > 0 && rectTdHora.width > 0 && rectTdHora.height > 0) {
                const horaInicioFilaMin = convertirHoraAMinutos(celdaHoraInicio.textContent.trim());
                const progresoEnMinutos = ahoraEnMinutos - horaInicioFilaMin; // Minutos transcurridos en el bloque actual
                const porcentajeProgreso = Math.max(0, Math.min(1, progresoEnMinutos / 30)); // Progreso 0-1
                const desplazamientoVertical = rectTdHora.height * porcentajeProgreso; // Posici√≥n vertical relativa

                lineaHorizontal.style.height = "1px"; // Grosor l√≠nea s√≥lida
                lineaHorizontal.style.top = `${rectTdHora.top + window.scrollY + desplazamientoVertical - 1}px`; // Posici√≥n Y (-1 para centrar)
                lineaHorizontal.style.left = `${rectTdHora.left + window.scrollX + rectTdHora.width}px`; // Posici√≥n X
                const anchoPrimeraColHora = celdaHoraInicio.offsetWidth;
                const anchoUltimaColHora = celdaHoraFin ? celdaHoraFin.offsetWidth : anchoPrimeraColHora; // Ancho cols hora
                lineaHorizontal.style.width = `${rectTable.width - anchoPrimeraColHora - anchoUltimaColHora}px`; // Ancho l√≠nea
                document.body.appendChild(lineaHorizontal); // A√±adir al DOM
            }
        }
        // L√≠nea Vertical
        if (celdaCabeceraDia) {
           const lineaVertical = document.createElement("div");
           lineaVertical.className = "linea-roja-extendida"; // CSS aplica fondo rojo
           const rectTh = celdaCabeceraDia.getBoundingClientRect(); // Posici√≥n cabecera d√≠a
           const rectTable = tabla.getBoundingClientRect(); // Posici√≥n tabla

           // Verificar validez de dimensiones
           if (rectTable.height > 0 && rectTh.width > 0 && rectTh.height > 0) {
                const desplazamientoHorizontal = rectTh.width / 2; // Centrar en la columna

                lineaVertical.style.width = "1px"; // Grosor l√≠nea s√≥lida
                lineaVertical.style.left = `${rectTh.left + window.scrollX + desplazamientoHorizontal - 1}px`; // Posici√≥n X (-1 para centrar)
                lineaVertical.style.top = `${rectTh.top + window.scrollY + rectTh.height}px`; // Posici√≥n Y
                lineaVertical.style.height = `${rectTable.height - rectTh.height}px`; // Altura l√≠nea
                document.body.appendChild(lineaVertical); // A√±adir al DOM
           }
        }


        // --- Encontrar y Resaltar Celda Actividad Actual (con clase .actual) ---
        if (indiceFilaActual !== -1 && celdaCabeceraDia) {
            // Misma l√≥gica compleja para encontrar celda considerando rowspan/colspan
            const filaActual = filas[indiceFilaActual];
            let celdaPotencial = null;
            let currentCellIndex = 1; // √çndice empieza despu√©s de celda de hora inicial
            for (let i = 0; i < filaActual.cells.length; i++) {
                const cell = filaActual.cells[i];
                // Saltar primera (hora) y √∫ltima (hora) celdas al buscar celda de actividad
                if (i === 0 || (filaActual.cells.length > 1 && cell === celdaHoraFin)) {
                   if(i === 0) currentCellIndex = 1; // Resetear √≠ndice correctamente
                   continue; // Saltar esta celda
                 }
                const colSpan = parseInt(cell.getAttribute("colspan")) || 1;
                // Comprobar si esta celda abarca la columna objetivo
                if (currentCellIndex <= columnaDiaObjetivo && currentCellIndex + colSpan > columnaDiaObjetivo) {
                    celdaPotencial = cell; break; // Celda encontrada
                }
                currentCellIndex += colSpan; // Mover al siguiente √≠ndice visual
            }
             // Si no se encontr√≥ en la fila actual, buscar en filas anteriores (por rowspan)
             if (!celdaPotencial) {
                 for (let prevRowIndex = indiceFilaActual - 1; prevRowIndex >= 0; prevRowIndex--) {
                    const filaPrevia = filas[prevRowIndex];
                    let searchCellIndex = 1; // √çndice empieza despu√©s de celda de hora inicial
                    for (let i = 0; i < filaPrevia.cells.length; i++) {
                        const cell = filaPrevia.cells[i];
                         // Saltar primera y potencialmente √∫ltima celda de hora en filas previas
                         const isLastCellHour = (filaPrevia.cells.length > 1 && i === filaPrevia.cells.length - 1 && filaPrevia.cells[i].querySelector('b')); // Heur√≠stica para celda de hora
                         if (i === 0 || isLastCellHour) {
                           if(i === 0) searchCellIndex = 1;
                           continue;
                         }
                        const colSpan = parseInt(cell.getAttribute("colspan")) || 1;
                        const rowSpan = parseInt(cell.getAttribute("rowspan")) || 1;
                        // Comprobar si esta celda abarca columna Y fila actual
                        if (searchCellIndex <= columnaDiaObjetivo && searchCellIndex + colSpan > columnaDiaObjetivo && prevRowIndex + rowSpan > indiceFilaActual) {
                            celdaPotencial = cell; break; // Celda encontrada
                        }
                        searchCellIndex += colSpan; // Mover al siguiente √≠ndice visual
                    }
                    if (celdaPotencial) break; // Salir si ya se encontr√≥
                 }
            }

            // Aplicar clase .actual para borde naranja
            if (celdaPotencial && celdaPotencial.tagName === 'TD') {
                celdaActividadActual = celdaPotencial;
                celdaActividadActual.classList.add("actual"); // <-- Clase para borde naranja
                // Obtener texto, limpiar espacios m√∫ltiples, o poner placeholder
                textoBloqueEncontrado = celdaActividadActual.textContent.trim().replace(/\s+/g, ' ') || "Libre/Vac√≠o";
            } else {
                 // Si no hay celda espec√≠fica (ej. columna libre), marcar como vac√≠o
                 textoBloqueEncontrado = "Libre/Vac√≠o";
            }
        } else {
             // Si la hora actual est√° fuera del rango de la tabla
             textoBloqueEncontrado = "Fuera de Horario";
        }

        // --- Mostrar Info del Bloque Actual ---
        // Usar locale vac√≠o `[]` para formato de hora por defecto del navegador
        const textoAhora = ahora.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false });
        const infoDiv = document.createElement("div");
        infoDiv.className = "bloque-actual-info"; // CSS define la apariencia
        infoDiv.textContent = `Now (${textoAhora}): ${textoBloqueEncontrado}`;
        document.body.appendChild(infoDiv);
      };

      // --- Ejecuci√≥n Inicial e Intervalos ---
      mostrarDiaHoraActual(); // Mostrar hora/fecha inicial
      resaltarCeldaActual(); // Resaltar celda inicial
      setInterval(mostrarDiaHoraActual, 60000); // Actualizar t√≠tulo cada minuto
      setInterval(resaltarCeldaActual, 15000); // Actualizar resaltado cada 15s (m√°s fluido)
      window.addEventListener('resize', resaltarCeldaActual); // Ajustar al redimensionar ventana

    </script>
</body>
</html>